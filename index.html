<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∂‡•á‡§≤‡•á‡§®‡•ç‡§¶‡•ç‡§∞ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ç ‡§ï‡§æ ‡§ó‡•Å‡§≤‡§æ‡§Æ ‡§¨‡•ã‡§ü ‡§∞‡§æ‡§Æ ‡§á‡§Ç‡§°‡§ø‡§Ø‡§æ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .status {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        .online { background: #4CAF50; color: white; }
        .offline { background: #f44336; color: white; }
        .error { background: #ff9800; color: white; }
        .panel {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            transition: all 0.3s;
        }
        button:hover {
            background: #0b7dda;
            transform: scale(1.02);
        }
        button:disabled {
            background: #555555;
            cursor: not-allowed;
        }
        input, select, textarea {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            border: 1px solid #444;
            border-radius: 4px;
            background: #333;
            color: white;
        }
        .log {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #444;
            padding: 10px;
            margin-top: 20px;
            font-family: monospace;
            background: #222;
            color: #00ff00;
            border-radius: 4px;
        }
        .log .error {
            color: #ff4444;
            font-weight: bold;
        }
        small {
            color: #888;
            font-size: 12px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background: #333;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
        }
        .tab.active {
            background: #2196F3;
            color: white;
        }
        h1, h2, h3 {
            color: #2196F3;
        }
        .command-list {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .command {
            margin: 5px 0;
            padding: 8px;
            background: #444;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>‡§∂‡•á‡§≤‡•á‡§®‡•ç‡§¶‡•ç‡§∞ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ç ‡§ï‡§æ ‡§ó‡•Å‡§≤‡§æ‡§Æ ‡§¨‡•ã‡§ü ‡§∞‡§æ‡§Æ ‡§á‡§Ç‡§°‡§ø‡§Ø‡§æ üî•</h1>
    
    <div class="status offline" id="status">
        Status: Offline
    </div>
    
    <div class="panel">
        <div class="tabs">
            <div class="tab active" data-tab="main">Main</div>
            <div class="tab" data-tab="abuse">Abuse System</div>
            <div class="tab" data-tab="settings">Settings</div>
            <div class="tab" data-tab="commands">Commands</div>
        </div>
        
        <div id="main-tab" class="tab-content active">
            <div>
                <input type="text" id="userId" placeholder="Enter your User ID">
                <small>Enter your Facebook User ID</small>
            </div>
            <div>
                <input type="file" id="cookie-file" accept=".txt,.json">
                <small>Select your cookie file (txt or json)</small>
            </div>
            <div>
                <input type="text" id="prefix" value="#" placeholder="Command prefix">
            </div>
            <div>
                <input type="text" id="admin-id" placeholder="Admin Facebook ID">
            </div>
            <button id="start-btn">Start Bot</button>
            <button id="stop-btn" disabled>Stop Bot</button>
            <button id="check-status-btn">Check Status</button>
        </div>
        
        <div id="abuse-tab" class="tab-content">
            <div>
                <label for="abuse-file">Abuse Messages File</label>
                <input type="file" id="abuse-file" accept=".txt">
                <small>Upload abuse.txt file with messages (one per line)</small>
            </div>
            <button id="upload-abuse">Upload Abuse File</button>
            <div style="margin-top: 20px;">
                <label for="welcome-messages">Welcome Messages (one per line)</label>
                <textarea id="welcome-messages" rows="5">
üåü Welcome {name} to the group! Enjoy your stay! üåü
üî• {name} just joined the party! Let's get wild! üî•
üëã Hey {name}, Shalender's crew welcomes you! Behave or get roasted! üëã
üéâ {name} has arrived! The fun begins now! üéâ
üòà Shalender's child {name} just entered! Watch your back! üòà
                </textarea>
                <button id="save-welcome">Save Welcome Messages</button>
            </div>
        </div>
        
        <div id="settings-tab" class="tab-content">
            <div>
                <label>
                    <input type="checkbox" id="auto-spam">
                    Auto Accept Spam Messages
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" id="auto-message">
                    Auto Accept Message Requests
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" id="auto-convo">
                    Auto Conversation Mode
                </label>
            </div>
            <button id="save-settings">Save Settings</button>
        </div>
        
        <div id="commands-tab" class="tab-content">
            <h3>Available Commands</h3>
            <div class="command-list">
                <div class="command">#help - Show all commands</div>
                <div class="command">#stopall - Stop all bots (Master only)</div>
                <div class="command">#status - Show active bot count (Master only)</div>
                <div class="command">#kick &lt;userId&gt; - Stop bot for specific user (Master only)</div>
                <div class="command">#list - List all active user IDs (Master only)</div>
                <div class="command">#groupnamelock on/off &lt;name&gt; - Lock group name</div>
                <div class="command">#nicknamelock on/off &lt;nickname&gt; - Lock all nicknames</div>
                <div class="command">#tid - Get group ID</div>
                <div class="command">#uid - Get your ID</div>
                <div class="command">#uid @mention - Get mentioned user's ID</div>
                <div class="command">#info @mention - Get user information</div>
                <div class="command">#group info - Get group information</div>
                <div class="command">#pair - Pair two random members</div>
                <div class="command">#music &lt;song name&gt; - Play YouTube music</div>
                <div class="command">#antiout on/off - Toggle anti-out feature</div>
                <div class="command">#send sticker start/stop - Sticker spam</div>
                <div class="command">#autospam accept - Auto accept spam messages</div>
                <div class="command">#automessage accept - Auto accept message requests</div>
                <div class="command">#loder target on @user - Target a user</div>
                <div class="command">#loder stop - Stop targeting</div>
                <div class="command">#unsend - Delete replied message</div>
                <div class="command">autoconvo on/off - Toggle auto conversation</div>
            </div>
        </div>
    </div>
    
    <div class="panel">
        <h3>Bot Logs</h3>
        <div class="log" id="log-container"></div>
    </div>

    <script>
        const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const wsUrl = protocol + window.location.host;
        let socket;
        const logContainer = document.getElementById('log-container');
        const statusDiv = document.getElementById('status');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const checkStatusBtn = document.getElementById('check-status-btn');
        const uploadAbuseBtn = document.getElementById('upload-abuse');
        const saveWelcomeBtn = document.getElementById('save-welcome');
        const saveSettingsBtn = document.getElementById('save-settings');
        const autoSpamCheckbox = document.getElementById('auto-spam');
        const autoMessageCheckbox = document.getElementById('auto-message');
        const autoConvoCheckbox = document.getElementById('auto-convo');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Persist userId across sessions
        let userId = localStorage.getItem('userId') || '';
        if (userId) {
            document.getElementById('userId').value = userId;
        }

        function addLog(message, type = 'info', userId = '') {
            console.log(`[Client Log] ${message}`);
            const logEntry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' });
            logEntry.textContent = `[${timestamp}]${userId ? ` [User ${userId}] ` : ''} ${message}`;
            if (type === 'error') {
                logEntry.classList.add('error');
            }
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(message, isRunning, isError = false, userId = '') {
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'status error' : isRunning ? 'status online' : 'status offline';
            startBtn.disabled = isRunning;
            stopBtn.disabled = !isRunning;
        }

        function setupSocket() {
            console.log(`Attempting to connect to WebSocket at ${wsUrl}`);
            socket = new WebSocket(wsUrl);
            
            socket.onopen = () => {
                addLog('Connected to bot server', 'info');
                console.log('WebSocket connection established');
                if (userId) {
                    socket.send(JSON.stringify({ type: 'checkStatus', userId }));
                }
            };
            
            socket.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    console.log('WebSocket message received:', data);
                    if (data.type === 'heartbeat') {
                        socket.send(JSON.stringify({ type: 'heartbeat' }));
                        return;
                    } else if (data.type === 'log') {
                        addLog(data.message, data.message.includes('failed') ? 'error' : 'info', data.userId);
                    } else if (data.type === 'error') {
                        addLog(data.message, 'error', data.userId);
                        updateStatus(`Error: ${data.message}`, false, true, data.userId);
                    } else if (data.type === 'status') {
                        const statusMessage = data.message || (data.running ? `Online (User: ${data.userId})` : `Offline (User: ${data.userId})`);
                        updateStatus(`Status: ${statusMessage}`, data.running, false, data.userId);
                    } else if (data.type === 'settings') {
                        autoSpamCheckbox.checked = data.autoSpamAccept;
                        autoMessageCheckbox.checked = data.autoMessageAccept;
                        autoConvoCheckbox.checked = data.autoConvo;
                        addLog('Settings updated from server', 'info');
                    } else if (data.type === 'activeUsers') {
                        addLog(`Active users: ${data.users.join(', ') || 'None'}`, 'info');
                    }
                } catch (err) {
                    console.error('Error parsing WebSocket message:', err.message);
                    addLog(`Error parsing server message: ${err.message}`, 'error');
                }
            };
            
            socket.onclose = (e) => {
                console.log('WebSocket disconnected:', e.reason || 'Unknown reason');
                addLog(`Disconnected: ${e.reason || 'Unknown reason'}`, 'error');
                updateStatus('Status: Offline (Disconnected)', false);
                setTimeout(setupSocket, 5000);
            };
            
            socket.onerror = (err) => {
                console.error('WebSocket error:', err);
                addLog('WebSocket error occurred', 'error');
                socket.close();
            };
        }

        // Persist bot session on page unload
        window.addEventListener('beforeunload', () => {
            if (socket && socket.readyState === WebSocket.OPEN && userId) {
                socket.send(JSON.stringify({ type: 'persistSession', userId }));
                console.log('Sent persistSession signal for user:', userId);
            }
        });

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });

        setupSocket();
        addLog('Control panel ready', 'info');

        startBtn.addEventListener('click', () => {
            userId = document.getElementById('userId').value.trim();
            const fileInput = document.getElementById('cookie-file');
            const prefix = document.getElementById('prefix').value.trim();
            const adminId = document.getElementById('admin-id').value.trim();

            if (!userId) {
                addLog('Please enter a User ID', 'error');
                return;
            }
            
            if (fileInput.files.length === 0) {
                addLog('Please select a cookie file', 'error');
                return;
            }
            
            if (!prefix) {
                addLog('Please enter a command prefix', 'error');
                return;
            }
            
            if (!adminId) {
                addLog('Please enter an Admin ID', 'error');
                return;
            }
            
            localStorage.setItem('userId', userId);
            updateStatus('Status: Starting...', false, false, userId);
            addLog('Reading cookie file...', 'info', userId);
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = (event) => {
                console.log('Cookie file read successfully');
                addLog('Cookie file read, sending to server...', 'info', userId);
                socket.send(JSON.stringify({
                    type: 'start',
                    userId,
                    cookieContent: event.target.result,
                    prefix,
                    adminId
                }));
            };
            
            reader.onerror = (err) => {
                console.error('Error reading cookie file:', err.message);
                addLog(`Error reading cookie file: ${err.message}`, 'error', userId);
                updateStatus('Status: Offline (Cookie file error)', false, true, userId);
            };
            
            reader.readAsText(file);
        });
        
        stopBtn.addEventListener('click', () => {
            userId = document.getElementById('userId').value.trim();
            if (!userId) {
                addLog('Please enter a User ID to stop bot', 'error');
                return;
            }
            console.log('Sending stop request for user:', userId);
            socket.send(JSON.stringify({ type: 'stop', userId }));
            addLog(`Stopping bot for User ID: ${userId}`, 'info', userId);
            updateStatus('Status: Stopping...', false, false, userId);
        });
        
        checkStatusBtn.addEventListener('click', () => {
            userId = document.getElementById('userId').value.trim();
            if (!userId) {
                addLog('Please enter a User ID to check status', 'error');
                return;
            }
            console.log('Sending check status request for user:', userId);
            socket.send(JSON.stringify({ type: 'checkStatus', userId }));
            addLog(`Checking status for User ID: ${userId}`, 'info', userId);
        });
        
        uploadAbuseBtn.addEventListener('click', () => {
            userId = document.getElementById('userId').value.trim();
            const fileInput = document.getElementById('abuse-file');
            if (!userId) {
                addLog('Please enter a User ID', 'error');
                return;
            }
            if (fileInput.files.length === 0) {
                addLog('Please select an abuse file', 'error', userId);
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = (event) => {
                console.log('Abuse file read successfully');
                addLog('Abuse file read, sending to server...', 'info', userId);
                socket.send(JSON.stringify({
                    type: 'uploadAbuse',
                    userId,
                    content: event.target.result
                }));
                addLog('Uploading abuse messages...', 'info', userId);
            };
            
            reader.onerror = (err) => {
                console.error('Error reading abuse file:', err.message);
                addLog(`Error reading abuse file: ${err.message}`, 'error', userId);
            };
            
            reader.readAsText(file);
        });
        
        saveWelcomeBtn.addEventListener('click', () => {
            const welcomeMessages = document.getElementById('welcome-messages').value;
            if (!welcomeMessages.trim()) {
                addLog('Welcome messages cannot be empty', 'error');
                return;
            }
            console.log('Sending welcome messages to server');
            socket.send(JSON.stringify({
                type: 'saveWelcome',
                content: welcomeMessages
            }));
            addLog('Saving welcome messages...', 'info');
        });
        
        saveSettingsBtn.addEventListener('click', () => {
            console.log('Sending settings to server');
            socket.send(JSON.stringify({
                type: 'saveSettings',
                autoSpamAccept: autoSpamCheckbox.checked,
                autoMessageAccept: autoMessageCheckbox.checked,
                autoConvo: autoConvoCheckbox.checked
            }));
            addLog('Saving bot settings...', 'info');
        });
    </script>
</body>
    </html>
